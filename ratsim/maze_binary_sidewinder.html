<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Generating mazes in rust using raylib</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Generating mazes in rust using raylib</h1>
<p class="date">Mon Apr 29 2024</p>
</header>
<h1 id="intro">Intro</h1>
<p>I’ve been playing with the idea of making a simulator for a micro mouse me and a friend have been working on. Why not get some rust expericence at the same time?! I’ll use a raycaster I wrote using raylib and rust to display the mazes. The raycaster is based on the C project by justinac0 https://github.com/justinac0/raylib-raycaster. The algorithms used here are created from the spec given in the first chapter of Jamis Buck’s Mazes for Programmers, great book so far!</p>
<h2 id="goals-for-this-post">Goals for this post</h2>
<ul>
<li>Generate random mazes using the binary tree algorithm</li>
<li>Generate random mazes using the side winder algorithm</li>
<li>Display the mazes in a raylib raycaster</li>
</ul>
<h2 id="out-of-scope">Out of scope</h2>
<ul>
<li>Write a raycaster, since I’ve already implemented that</li>
</ul>
<h1 id="the-grid">The Grid</h1>
<p>I’ve not implemented any fancy object to represent the grid, all it is is a 2D array where even rows and columns contain the mazes walls and the odd rows and columns are the cells of the maze.</p>
<h1 id="binary-tree">Binary tree</h1>
<p>Is the simplest of the two. My implementation starts in the upper left corner and then randomly digs south or east before moving to the next column in the row looping over all the cells in the grid once. Since the cells are at odd rows and columns we loop over the cells by stepping by 2. In addition to this I handle the literal edge cases; the right most column and bottom row.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">fn</span> binary_tree() <span class="op">-&gt;</span> [[<span class="dt">u8</span><span class="op">;</span> maph]<span class="op">;</span> mapl] <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="co">// binary tree algorithim starting in the north west corner</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    <span class="co">// and generating a maze down and to the east.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> map <span class="op">=</span> [[<span class="dv">1</span><span class="op">;</span> mapl]<span class="op">;</span> maph]<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    <span class="kw">for</span> i <span class="kw">in</span> (<span class="dv">1</span><span class="op">..</span>mapl<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span>step_by(<span class="dv">2</span>) <span class="op">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>        <span class="kw">for</span> j <span class="kw">in</span> (<span class="dv">1</span><span class="op">..</span>maph<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span>step_by(<span class="dv">2</span>) <span class="op">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>            map[i][j] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>            <span class="kw">if</span> i <span class="op">==</span> mapl <span class="op">-</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span>  j <span class="op">==</span> maph <span class="op">-</span><span class="dv">2</span> <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>                <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>            <span class="kw">if</span> i <span class="op">==</span> mapl <span class="op">-</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>                <span class="co">// dig east</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>                map[i][j<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>                <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>            <span class="kw">if</span> j <span class="op">==</span> maph <span class="op">-</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>                <span class="co">//dig south</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>                map[i<span class="op">+</span><span class="dv">1</span>][j] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>                <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>            <span class="kw">if</span> <span class="pp">rand::random::</span><span class="op">&lt;</span><span class="dt">bool</span><span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>                <span class="co">// dig east</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>                map[i<span class="op">+</span><span class="dv">1</span>][j] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>                map[i][j<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>    <span class="kw">return</span> map<span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>It produces an OK looking maze shown in Fig 1, but with the bias of a long corridor in the east and south ends. <img src="img/binary_tree.png" alt="Fig. 1" /></p>
<h1 id="sidewinder">Sidewinder</h1>
<p>Is similar to the binary tree algorithm except that when the binary tree would dig south at the current cell, sidewinder digs south at a random cell in the previous run, where the previous run is the cells in the current row since the last time we dug south.</p>
<p>One problem I got stumbled into with this algo is that I forgot to handle the fact that my map array contains both the walls and columns, so instead of picking a random cell in the entire current run I need to only consider the odd columns in the row, i.e. </p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="pp">rand::</span>thread_rng()<span class="op">.</span>gen_range(<span class="op">*</span>runstart_col<span class="op">/</span><span class="dv">2</span><span class="op">..</span>curr_col<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span></span></code></pre></div>
<p>instead of</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="pp">rand::</span>thread_rng()<span class="op">.</span>gen_range(<span class="op">*</span>runstart_col<span class="op">..</span>curr_col)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">fn</span> sidewinder() <span class="op">-&gt;</span> [[<span class="dt">u8</span><span class="op">;</span> MAPH]<span class="op">;</span> MAPL] <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>    <span class="co">// Binary tree algorithim starting in the north west corner</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    <span class="co">// and generating a maze down and to the east.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> map <span class="op">=</span> [[<span class="dv">1</span><span class="op">;</span> MAPL]<span class="op">;</span> MAPH]<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="kw">fn</span> close_run(runstart_col<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="dt">usize</span><span class="op">,</span> curr_row<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> curr_col<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> map<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> [[<span class="dt">u8</span><span class="op">;</span> MAPH]<span class="op">;</span> MAPL]) <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>        <span class="kw">let</span> random_column <span class="op">=</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>        <span class="kw">if</span> <span class="op">*</span>runstart_col <span class="op">==</span> curr_col <span class="op">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>            <span class="op">*</span>runstart_col</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>            <span class="pp">rand::</span>thread_rng()<span class="op">.</span>gen_range(<span class="op">*</span>runstart_col<span class="op">/</span><span class="dv">2</span><span class="op">..</span>curr_col<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>        <span class="co">//dig south at random column in run</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>        map[curr_row<span class="op">+</span><span class="dv">1</span>][random_column] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>        <span class="op">*</span>runstart_col <span class="op">=</span> curr_col<span class="op">+</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>    <span class="kw">for</span> i <span class="kw">in</span> (<span class="dv">1</span><span class="op">..</span>MAPL<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span>step_by(<span class="dv">2</span>) <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> runstart_col <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>        <span class="kw">for</span> j <span class="kw">in</span> (<span class="dv">1</span><span class="op">..</span>MAPH<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span>step_by(<span class="dv">2</span>) <span class="op">{</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>            map[i][j] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a>            <span class="kw">if</span> i <span class="op">==</span> MAPL <span class="op">-</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span>  j <span class="op">==</span> MAPH <span class="op">-</span><span class="dv">2</span> <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>                <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>            <span class="kw">if</span> i <span class="op">==</span> MAPL <span class="op">-</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a>                <span class="co">// dig east</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>                map[i][j<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a>                <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true"></a>            <span class="kw">if</span> <span class="pp">rand::random::</span><span class="op">&lt;</span><span class="dt">bool</span><span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true"></a>                <span class="kw">if</span> j <span class="op">==</span> MAPH<span class="op">-</span><span class="dv">2</span> <span class="op">{</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true"></a>                    close_run(<span class="op">&amp;</span><span class="kw">mut</span> runstart_col<span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> <span class="op">&amp;</span><span class="kw">mut</span> map)<span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true"></a>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true"></a>                    <span class="co">// dig east</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true"></a>                    map[i][j<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true"></a>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true"></a>                close_run(<span class="op">&amp;</span><span class="kw">mut</span> runstart_col<span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> <span class="op">&amp;</span><span class="kw">mut</span> map)<span class="op">;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true"></a>    <span class="kw">return</span> map<span class="op">;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>This produces a similar maze to the binary tree but without the long empty eastern column and with a bias towards longer horizontal paths. <img src="img/sidewinder.png" alt="Fig. 2" /></p>
</body>
</html>
